<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
    
  <mapper namespace="Dashboard">
	
	<select id="joinTable" resultType="kh.spring.dto.DashboardDTO">
		select 
    		u.stan_date, 
    		nvl(u.user_n,0) as user_n,
    		nvl(p.plan,0) as plan,
    		nvl(t.tour_board,0) as tour_board,
    		nvl(c.com_board,0) as com_board
		from (select to_char(signup_date, 'YYYYMMDD') as stan_date, count(*) as user_n from member 
            	where to_char(signup_date, 'YYYYMMDD') <![CDATA[ >= ]]> '20220125' and to_char(signup_date, 'YYYYMMDD') <![CDATA[ <= ]]> to_char(sysdate, 'YYYYMMDD')
            	group by to_char(signup_date, 'YYYYMMDD')) u 
    	full outer join(select to_char(writen_date, 'YYYYMMDD') as stan_date, count(*) as plan from plan
                where to_char(writen_date, 'YYYYMMDD') <![CDATA[ >= ]]> '20220125' and to_char(writen_date, 'YYYYMMDD') <![CDATA[ <= ]]> to_char(sysdate, 'YYYYMMDD')
                group by to_char(writen_date, 'YYYYMMDD')) p
        	on(u.stan_date = p.stan_date)
    	full outer join  (select to_char(writen_date, 'YYYYMMDD') as stan_date, count(*) as tour_board from tour_board
                where to_char(writen_date, 'YYYYMMDD') <![CDATA[ >= ]]> '20220125' and to_char(writen_date, 'YYYYMMDD') <![CDATA[ <= ]]> to_char(sysdate, 'YYYYMMDD')
                group by to_char(writen_date, 'YYYYMMDD')) t
        	on(u.stan_date = t.stan_date)
    	full outer join (select to_char(writen_date, 'YYYYMMDD') as stan_date, count(*) as com_board from company_board
                where to_char(writen_date, 'YYYYMMDD') <![CDATA[ >= ]]> '20220125' and to_char(writen_date, 'YYYYMMDD') <![CDATA[ <= ]]> to_char(sysdate, 'YYYYMMDD')
                group by to_char(writen_date, 'YYYYMMDD')) c
        	on(u.stan_date = c.stan_date)
			order by u.stan_date asc		
	</select>
	
	<insert id="insertTable">
		insert into dashboard values(${stan_date}, ${visitor}, ${user_n}, ${plan}, ${tour_board}, ${com_board})
	</insert>
	
	<select id="selectAllDash" resultType="kh.spring.dto.DashboardDTO">
		select * from dashboard
	</select>
	
	<delete id ="deleteTable">
		delete from dashboard
	</delete>
 		
  </mapper>